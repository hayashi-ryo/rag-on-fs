# rag-on-fs

## アーキテクチャ概要

```text
+-------------------------+        +-------------------------+
|    ユーザー（日本語）    | <----> |     チャットUI（Web）    |
+-------------------------+        +-------------------------+
                                               |
                                               v
                      +--------------------------------------------------+
                      |       RAGアーキテクチャ（社内ネットワーク内）       |
                      +--------------------------------------------------+
                      |                                               |
                      | 1. ユーザー質問（クエリ）                         |
                      | 2. ドキュメント検索（Retriever）                 |
                      | 3. 回答生成（Generator, LLM）                   |
                      | 4. 回答と引用元ファイルパスを返却                  |
                      +--------------------------------------------------+
                                |                           |
                                |                           |
                                v                           v
         +--------------------------------+     +--------------------------+
         |     ベクトルDB（検索インデックス）     |     |    MCPサーバー連携層       |
         |  - テキスト/Word/Excel/PDFの分割・埋込   |     |  - ファイルパスとディレクトリ構造管理 |
         |  - ディレクトリ構造も埋め込み特徴に含める |     |  - ファイルの原文取得 or 表示支援     |
         +--------------------------------+     +--------------------------+
                                |
                                v
            +---------------------------------------------+
            |   ドキュメントパイプライン（事前処理）        |
            |  - Office/PDF → テキスト抽出（python-docx, xlrd, pdfplumberなど） |
            |  - chunk分割（構造保持）+ embedding生成       |
            |  - ベクトルDB（例：FAISS, Qdrant）へ登録     |
            +---------------------------------------------+
```

## 構成要素

| 要素 | 内容 |
| ---- | ---- |
| チャットUI |フォームに質問を入力すると、回答と引用元ファイル名が表示されシンプルなUI |
|Retriever|質問に関連する文書DBを検索(ベクトルDBを利用)|
|Generator|文書と質問を元にLLMが回答を生成(ローカルLLMを利用予定)|
|ベクトルDB|テキストやファイルをベクトル化して格納(Qdrant、FAISSなど)|
|前処理|Officeファイル、PDFを構造を保ったまま分割・埋め込み生成。PDFはOCRせず、テキスト可能部分のみ処理|
|MCPサーバー|ベクトルDB上の検索結果から「原ファイルパス」を返し、ユーザーへリンク・パス情報表示など。ディレクトリ構造の意味付けも担保可能|

## 技術スタック

### 初期案

| 機能          | 技術案                                                         |
| ----------- | ----------------------------------------------------------- |
| チャットUI      | Streamlit / Gradio / Flask＋Vueなど                            |
| ドキュメント抽出    | `python-docx`, `openpyxl`, `pdfplumber`, `PyMuPDF`          |
| Embedding生成 | `sentence-transformers`, `bge-m3`, `ja-sbert`など（日本語対応）      |
| ベクトルDB      | Qdrant / FAISS（20GBならローカルでも十分対応可能）                          |
| RAG構成統合     | LangChain / LlamaIndex                                      |
| LLM         | LLaMA.cppベースの日本語モデル（koichi’s models等） or Azure OpenAI (閉域用) |
| MCP連携       | MCP APIまたはFS直アクセスでファイル情報参照、パス返却                             |
